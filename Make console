// This script is for computers with restrinctions on them to allow them too use the dev console without needing to ask their parent.
// DO NOT include these notes in the bookmarklet!!
javascript:(function(){if(document.getElementById('scriptRunnerContainer')){console.log('Script Runner already exists.');return;}const container=document.createElement('div');container.id='scriptRunnerContainer';container.style.cssText='position:fixed;bottom:10px;right:10px;width:450px;height:300px;background-color:rgba(20,20,20,0.98);border:1px solid #444;box-shadow:3px 3px 20px rgba(0,0,0,0.8);z-index:10000;display:flex;flex-direction:column;font-family:\'Fira Code\',\'Cascadia Code\',monospace;font-size:14px;resize:both;overflow:hidden;border-radius:8px;';const header=document.createElement('div');header.style.cssText='padding:10px 15px;background-color:#111;border-bottom:1px solid #333;cursor:grab;font-weight:bold;color:#bbb;border-top-left-radius:8px;border-top-right-radius:8px;display:flex;justify-content:space-between;align-items:center;text-shadow:1px 1px 2px rgba(0,0,0,0.5);';header.textContent='Advanced Script Runner';const closeButton=document.createElement('span');closeButton.textContent='âœ•';closeButton.style.cssText='color:#ff6b6b;font-size:18px;font-weight:bold;cursor:pointer;padding:0 5px;';header.appendChild(closeButton);const inputWrapper=document.createElement('div');inputWrapper.style.cssText='flex-grow:1;margin:6px;border:1px solid #555;background-color:#000;border-radius:4px;overflow-y:auto;padding:8px;color:#e0e0e0;font-family:\'Fira Code\',\'Cascadia Code\',monospace;font-size:13px;';const codeInput=document.createElement('div');codeInput.contentEditable='true';codeInput.spellcheck=false;codeInput.style.cssText='outline:none;min-height:100%;white-space:pre-wrap;word-break:break-all;caret-color:#00ffff;';const placeholderText='Type your JavaScript here...';const placeholderColor='#888';codeInput.innerHTML=`<span style="color:${placeholderColor};">${placeholderText}</span>`;let isPlaceholderActive=true;inputWrapper.appendChild(codeInput);const runButton=document.createElement('button');runButton.textContent='Run Script';runButton.style.cssText='padding:10px 20px;margin:6px auto 6px 6px;background-color:#333;color:#00ff99;border:1px solid #666;cursor:pointer;border-radius:5px;font-weight:bold;transition:background-color 0.2s, color 0.2s;';runButton.onmouseover=()=>runButton.style.backgroundColor='#444';runButton.onmouseout=()=>runButton.style.backgroundColor='#333';const outputDiv=document.createElement('pre');outputDiv.style.cssText='margin:6px;padding:10px;background-color:rgba(0,0,0,0.8);border:1px solid #555;height:90px;overflow:auto;white-space:pre-wrap;word-break:break-all;font-family:\'Fira Code\',\'Cascadia Code\',monospace;font-size:13px;color:#ccc;border-radius:4px;';outputDiv.innerHTML='<span style="color:#888;">Output:</span>\\n';container.appendChild(header);container.appendChild(inputWrapper);container.appendChild(runButton);container.appendChild(outputDiv);document.body.appendChild(container);let isDragging=false;let offsetX,offsetY;header.addEventListener('mousedown',(e)=>{if(e.target===closeButton)return;isDragging=true;offsetX=e.clientX-container.getBoundingClientRect().left;offsetY=e.clientY-container.getBoundingClientRect().top;container.style.cursor='grabbing';});document.addEventListener('mousemove',(e)=>{if(!isDragging)return;container.style.left=`${e.clientX-offsetX}px`;container.style.top=`${e.clientY-offsetY}px`;});document.addEventListener('mouseup',()=>{isDragging=false;container.style.cursor='grab';});closeButton.addEventListener('click',(e)=>{e.stopPropagation();container.remove();});function getCaretCharacterOffset(element){let caretOffset=0;const sel=window.getSelection();if(sel.rangeCount>0){const range=sel.getRangeAt(0);const preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(element);preCaretRange.setEnd(range.endContainer,range.endOffset);caretOffset=preCaretRange.toString().length;}return caretOffset;}function setCaretPosition(element,offset){const range=document.createRange();const selection=window.getSelection();let charCount=0;let found=false;function traverseNodes(node){if(found)return;if(node.nodeType===Node.TEXT_NODE){const nodeLength=node.textContent.length;if(charCount+nodeLength>=offset){range.setStart(node,offset-charCount);range.collapse(true);found=true;}else{charCount+=nodeLength;}}else{for(let i=0;i<node.childNodes.length;i++){traverseNodes(node.childNodes[i]);if(found)return;}}}traverseNodes(element);if(found){selection.removeAllRanges();selection.addRange(range);element.focus();}}const highlightText=(text)=>{text=text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');text=text.replace(/(`)([^`]*)(`)/g,'<span style="color:#98fb98;">$1</span><span style="color:#a8e6a8;">$2</span><span style="color:#98fb98;">$3</span>');text=text.replace(/(")([^"]*)(")/g,'<span style="color:#87ceeb;">$1</span><span style="color:#b0e0e6;">$2</span><span style="color:#87ceeb;">$3</span>');text=text.replace(/(')([^']*)(')/g,'<span style="color:#ffa500;">$1</span><span style="color:#ffcc80;">$2</span><span style="color:#ffa500;">$3</span>');text=text.replace(/(\[)/g,'<span style="color:#ff6347;">$1</span>');text=text.replace(/(\])/g,'<span style="color:#ff6347;">$1</span>');text=text.replace(/(\{)/g,'<span style="color:#da70d6;">$1</span>');text=text.replace(/(\})/g,'<span style="color:#da70d6;">$1</span>');text=text.replace(/(\()/g,'<span style="color:#ffd700;">$1</span>');text=text.replace(/(\))/g,'<span style="color:#ffd700;">$1</span>');text=text.replace(/\b(function|const|let|var|return|if|else|for|while|new|this|await|async|import|export|class|extends|super|try|catch|finally|throw|debugger)\b/g,'<span style="color:#00ffff;">$&</span>');text=text.replace(/\b(true|false|null|undefined)\b/g,'<span style="color:#ffa07a;">$&</span>');text=text.replace(/\b(console|document|window|Math|Date|JSON|RegExp)\b/g,'<span style="color:#90ee90;">$&</span>');text=text.replace(/\b(\d+(\.\d+)?([eE][+-]?\d+)?)\b/g,'<span style="color:#b0e0e6;">$&</span>');text=text.replace(/(\/\/.*)/g,'<span style="color:#666;">$1</span>');text=text.replace(/(\/\*[\s\S]*?\*\/)/g,'<span style="color:#666;">$1</span>');return text;};const applyHighlighting=()=>{const currentText=codeInput.textContent;if(isPlaceholderActive&&currentText===placeholderText){return;}const caretOffset=getCaretCharacterOffset(codeInput);codeInput.innerHTML=highlightText(currentText);setCaretPosition(codeInput,caretOffset);};codeInput.addEventListener('focus',()=>{if(isPlaceholderActive){codeInput.textContent='';isPlaceholderActive=false;}});codeInput.addEventListener('blur',()=>{if(codeInput.textContent.trim()===''){codeInput.innerHTML=`<span style="color:${placeholderColor};">${placeholderText}</span>`;isPlaceholderActive=true;setCaretPosition(codeInput,0);}});codeInput.addEventListener('input',()=>{if(isPlaceholderActive&&codeInput.textContent.trim()!==''&&codeInput.textContent!==placeholderText){isPlaceholderActive=false;}else if(!isPlaceholderActive&&codeInput.textContent.trim()===''){}});applyHighlighting();if(isPlaceholderActive){setCaretPosition(codeInput,0);}runButton.addEventListener('click',()=>{const script=codeInput.textContent;outputDiv.innerHTML='<span style="color:#888;">Output:</span>\\n';const originalConsoleLog=console.log;const originalConsoleWarn=console.warn;const originalConsoleError=console.error;console.log=(...args)=>{outputDiv.innerHTML+=args.map(arg=>typeof arg==='object'?`<span style="color:#c0e0f0;">${JSON.stringify(arg,null,2)}</span>`:`<span style="color:#c0e0f0;">${String(arg)}</span>`).join(' ')+'<br>';originalConsoleLog(...args);};console.warn=(...args)=>{outputDiv.innerHTML+=`<span style="color:#ffd700;">Warning:</span> ${args.map(arg=>typeof arg==='object'?`<span style="color:#ffe066;">${JSON.stringify(arg,null,2)}</span>`:`<span style="color:#ffe066;">${String(arg)}</span>`).join(' ')+'<br>'}`;originalConsoleWarn(...args);};console.error=(...args)=>{outputDiv.innerHTML+=`<span style="color:#ff4d4d;">Error:</span> ${args.map(arg=>typeof arg==='object'?`<span style="color:#ff8a8a;">${JSON.stringify(arg,null,2)}</span>`:`<span style="color:#ff8a8a;">${String(arg)}</span>`).join(' ')+'<br>'}`;originalConsoleError(...args);};try{const result=eval(script);if(result!==undefined){outputDiv.innerHTML+='<span style="color:#00ffff;">Result:</span> <span style="color:#e0ffff;">'+(typeof result==='object'?JSON.stringify(result,null,2):String(result))+'</span><br>';}}catch(error){outputDiv.innerHTML+=`<span style="color:#ff4d4d;">Runtime Error:</span> <span style="color:#ff8a8a;">${error.message}</span><br>`;if(error instanceof ReferenceError){const errorName=error.message.split(' ')[0];const globalKeys=Object.keys(window).filter(key=>typeof window[key]!=='function'&&!key.startsWith('webkit')&&!key.startsWith('moz')&&!key.startsWith('__'));const matches=[];for(const key of globalKeys){if(key.toLowerCase().includes(errorName.toLowerCase())||errorName.toLowerCase().includes(key.toLowerCase().substring(0,Math.min(key.length,errorName.length)))&&key.length>2){matches.push(key);}}if(matches.length>0){outputDiv.innerHTML+=`<span style="color:#ffd700;">Did you mean?</span> <span style="color:#eee;">${matches.slice(0,5).join(', ')}</span><br>`;}}originalConsoleError('Script Runner Runtime Error:',error);}finally{console.log=originalConsoleLog;console.warn=originalConsoleWarn;console.error=originalConsoleError;}});})();
